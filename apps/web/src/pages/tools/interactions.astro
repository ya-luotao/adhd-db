---
import { getDrugs, getLocalizedValue } from '../../lib/data';
import { getLangFromUrl, useTranslations, getLocalizedPath } from '../../i18n/utils';

export const prerender = true;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const drugs = getDrugs();

// Prepare drug data for client-side
const drugsData = JSON.stringify(drugs.map(drug => ({
  id: drug.id,
  genericName: getLocalizedValue(drug.genericName, lang),
  drugClass: drug.drugClass,
  category: drug.category,
  controlledSubstance: drug.controlledSubstance,
  drugInteractions: drug.drugInteractions?.map(i => ({
    drug: getLocalizedValue(i.drug as any, lang),
    severity: i.severity,
    effect: getLocalizedValue(i.effect as any, lang),
  })) || [],
})));

// Common drug classes for quick-check
const drugClasses = [
  { id: 'MAOI', label: 'MAOIs', labelZh: 'MAOIs', labelJa: 'MAOIs' },
  { id: 'SSRI', label: 'SSRIs', labelZh: 'SSRIs', labelJa: 'SSRIs' },
  { id: 'SNRI', label: 'SNRIs', labelZh: 'SNRIs', labelJa: 'SNRIs' },
  { id: 'TCA', label: 'TCAs', labelZh: 'TCAs', labelJa: 'TCAs' },
  { id: 'benzodiazepine', label: 'Benzodiazepines', labelZh: 'è‹¯äºŒæ°®å“ç±»', labelJa: 'ãƒ™ãƒ³ã‚¾ã‚¸ã‚¢ã‚¼ãƒ”ãƒ³' },
  { id: 'antipsychotic', label: 'Antipsychotics', labelZh: 'æŠ—ç²¾ç¥ç—…è¯', labelJa: 'æŠ—ç²¾ç¥ç—…è–¬' },
];

const drugClassesData = JSON.stringify(drugClasses);

// Nutrient warnings
const nutrients = [
  {
    id: 'vitamin-c',
    name: { en: 'Vitamin C', zh: 'ç»´ç”Ÿç´ C', ja: 'ãƒ“ã‚¿ãƒŸãƒ³C' },
    affectedDrugs: ['stimulant'],
    severity: 'moderate',
    effect: { en: 'Acidifies urine, reduces amphetamine effectiveness', zh: 'é…¸åŒ–å°¿æ¶²ï¼Œé™ä½å®‰éä»–å‘½æ•ˆæœ', ja: 'å°¿ã‚’é…¸æ€§åŒ–ã—ã€ã‚¢ãƒ³ãƒ•ã‚§ã‚¿ãƒŸãƒ³ã®åŠ¹æœã‚’ä½ä¸‹' },
    recommendation: { en: 'Take 2+ hours apart from stimulant medications', zh: 'ä¸å…´å¥‹å‰‚è¯ç‰©é—´éš”2å°æ—¶ä»¥ä¸Š', ja: 'åˆºæ¿€è–¬ã¨2æ™‚é–“ä»¥ä¸Šã‚ã‘ã‚‹' },
  },
  {
    id: 'caffeine',
    name: { en: 'Caffeine', zh: 'å’–å•¡å› ', ja: 'ã‚«ãƒ•ã‚§ã‚¤ãƒ³' },
    affectedDrugs: ['stimulant'],
    severity: 'moderate',
    effect: { en: 'Additive CNS stimulation, increased anxiety/cardiovascular effects', zh: 'å åŠ ä¸­æ¢ç¥ç»åˆºæ¿€ï¼Œå¢åŠ ç„¦è™‘/å¿ƒè¡€ç®¡å½±å“', ja: 'ç›¸åŠ çš„ãªä¸­æ¢åˆºæ¿€ã€ä¸å®‰ãƒ»å¿ƒè¡€ç®¡ç³»ã¸ã®å½±éŸ¿å¢—åŠ ' },
    recommendation: { en: 'Limit caffeine intake while on stimulant medications', zh: 'æœç”¨å…´å¥‹å‰‚æ—¶é™åˆ¶å’–å•¡å› æ‘„å…¥', ja: 'åˆºæ¿€è–¬æœç”¨ä¸­ã¯ã‚«ãƒ•ã‚§ã‚¤ãƒ³æ‘‚å–ã‚’åˆ¶é™' },
  },
  {
    id: 'grapefruit',
    name: { en: 'Grapefruit', zh: 'è‘¡è„æŸš', ja: 'ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„' },
    affectedDrugs: ['guanfacine'],
    severity: 'moderate',
    effect: { en: 'Inhibits CYP3A4, increases guanfacine blood levels', zh: 'æŠ‘åˆ¶CYP3A4ï¼Œå¢åŠ èƒæ³•è¾›è¡€è¯æµ“åº¦', ja: 'CYP3A4ã‚’é˜»å®³ã—ã€ã‚°ã‚¢ãƒ³ãƒ•ã‚¡ã‚·ãƒ³ã®è¡€ä¸­æ¿ƒåº¦ä¸Šæ˜‡' },
    recommendation: { en: 'Avoid grapefruit products while taking guanfacine', zh: 'æœç”¨èƒæ³•è¾›æœŸé—´é¿å…è‘¡è„æŸš', ja: 'ã‚°ã‚¢ãƒ³ãƒ•ã‚¡ã‚·ãƒ³æœç”¨ä¸­ã¯ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’é¿ã‘ã‚‹' },
  },
  {
    id: 'alcohol',
    name: { en: 'Alcohol', zh: 'é…’ç²¾', ja: 'ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«' },
    affectedDrugs: ['all'],
    severity: 'major',
    effect: { en: 'Masks intoxication, worsens ADHD symptoms, cardiovascular strain', zh: 'æ©ç›–ä¸­æ¯’ç—‡çŠ¶ï¼Œæ¶åŒ–ADHDç—‡çŠ¶ï¼Œå¿ƒè¡€ç®¡è´Ÿæ‹…', ja: 'ä¸­æ¯’ç—‡çŠ¶ã‚’éš ã—ã€ADHDç—‡çŠ¶ã‚’æ‚ªåŒ–ã€å¿ƒè¡€ç®¡ã¸ã®è² æ‹…' },
    recommendation: { en: 'Avoid alcohol while taking ADHD medications', zh: 'æœç”¨ADHDè¯ç‰©æœŸé—´é¿å…é¥®é…’', ja: 'ADHDè–¬æœç”¨ä¸­ã¯ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ã‚’é¿ã‘ã‚‹' },
  },
];

const nutrientsData = JSON.stringify(nutrients);

const alternates = [
  { lang: 'en', path: '/tools/interactions' },
  { lang: 'zh', path: '/zh/tools/interactions' },
  { lang: 'ja', path: '/ja/tools/interactions' },
  { lang: 'zh-TW', path: '/zh-TW/tools/interactions' },
];
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <meta name="generator" content={Astro.generator} />
    <title>{t('tools.interactions.title')} | ADHD-DB</title>
    <meta name="description" content={t('tools.interactions.description')} />
    {alternates.map(({ lang: l, path }) => (
      <link rel="alternate" hreflang={l} href={path} />
    ))}
  </head>
  <body>
    <div class="page">
      <!-- Navigation -->
      <nav class="nav">
        <a href={getLocalizedPath('/', lang)} class="nav-logo">
          <span class="logo-mark">â—†</span>
          <span class="logo-text">ADHD-DB</span>
        </a>
        <div class="nav-links">
          <a href={getLocalizedPath('/data/drugs', lang)}>Database</a>
          <a href={getLocalizedPath('/tools/interactions', lang)} class="active">Tools</a>
          <a href={getLocalizedPath('/travel', lang)}>Travel</a>
          <a href="https://github.com/ya-luotao/adhd-db" target="_blank" rel="noopener">GitHub</a>
        </div>
        <div class="nav-lang">
          {alternates.map(({ lang: code, path }) => (
            <a href={path} class:list={['lang-link', { active: lang === code }]}>
              {code === 'en' ? 'EN' : code === 'zh' ? 'ä¸­æ–‡' : code === 'zh-TW' ? 'ç¹é«”' : 'æ—¥æœ¬èª'}
            </a>
          ))}
        </div>
      </nav>

      <!-- Hero -->
      <header class="hero">
        <div class="hero-badge">
          <span class="badge-icon">âš—</span>
          <span>{t('tools.interactions.badge')}</span>
        </div>
        <h1 class="hero-title">{t('tools.interactions.title')}</h1>
        <p class="hero-desc">{t('tools.interactions.description')}</p>
      </header>

      <!-- Checker Tool -->
      <main class="tool-section">
        <div class="checker-container">
          <!-- Drug Selection -->
          <div class="checker-form">
            <div class="form-header">
              <span class="form-step">1</span>
              <h2>{t('tools.interactions.selectMeds')}</h2>
            </div>

            <div class="drug-grid">
              {drugs.map(drug => (
                <label class="drug-checkbox" data-class={drug.drugClass}>
                  <input type="checkbox" name="drug" value={drug.id} />
                  <span class="checkbox-mark"></span>
                  <span class="checkbox-label">{getLocalizedValue(drug.genericName, lang)}</span>
                  <span class="checkbox-class">{drug.drugClass === 'stimulant' ? t('drugs.stimulant') : t('drugs.nonStimulant')}</span>
                </label>
              ))}
            </div>

            <div class="form-header">
              <span class="form-step">2</span>
              <h2>{t('tools.interactions.checkAgainst')}</h2>
            </div>

            <div class="class-buttons">
              {drugClasses.map(cls => (
                <button class="class-button" data-class={cls.id}>
                  {lang === 'zh' || lang === 'zh-TW' ? cls.labelZh : lang === 'ja' ? cls.labelJa : cls.label}
                </button>
              ))}
            </div>

            <button id="check-btn" class="check-button">
              <span>{t('tools.interactions.check')}</span>
              <span class="btn-arrow">â†’</span>
            </button>
          </div>

          <!-- Results -->
          <div id="results" class="results hidden">
            <div class="results-header">
              <h2>{t('tools.interactions.results')}</h2>
              <button id="clear-btn" class="clear-button">{t('tools.interactions.clear')}</button>
            </div>
            <div id="results-content"></div>
          </div>

          <!-- Nutrient Warnings -->
          <div class="nutrient-section">
            <div class="section-header">
              <span class="section-icon">ğŸŠ</span>
              <h2>{t('tools.interactions.nutrientWarnings')}</h2>
            </div>
            <div class="nutrient-grid">
              {nutrients.map(n => (
                <div class="nutrient-card" data-severity={n.severity}>
                  <div class="nutrient-header">
                    <span class="nutrient-name">{n.name[lang] || n.name.en}</span>
                    <span class="nutrient-severity" data-severity={n.severity}>
                      {n.severity === 'major' ? 'âš ' : 'â—'}
                    </span>
                  </div>
                  <p class="nutrient-effect">{n.effect[lang] || n.effect.en}</p>
                  <p class="nutrient-rec">{n.recommendation[lang] || n.recommendation.en}</p>
                </div>
              ))}
            </div>
          </div>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
          <div class="disclaimer-icon">âš </div>
          <div class="disclaimer-content">
            <strong>{t('tools.interactions.disclaimer.title')}</strong>
            <p>{t('tools.interactions.disclaimer.text')}</p>
          </div>
        </div>
      </main>

      <!-- Quick Links -->
      <section class="quick-links">
        <a href={getLocalizedPath('/tools/region-checker', lang)} class="quick-link">
          <span class="quick-icon">ğŸŒ</span>
          <div class="quick-content">
            <h3>{t('tools.regionChecker.title')}</h3>
            <p>{t('tools.regionChecker.description')}</p>
          </div>
          <span class="quick-arrow">â†’</span>
        </a>
        <a href={getLocalizedPath('/data/drugs', lang)} class="quick-link">
          <span class="quick-icon">â—‰</span>
          <div class="quick-content">
            <h3>{t('nav.database')}</h3>
            <p>{t('home.databaseDescription')}</p>
          </div>
          <span class="quick-arrow">â†’</span>
        </a>
      </section>

      <!-- Footer -->
      <footer class="footer">
        <div class="footer-content">
          <p class="footer-disclaimer">{t('tools.interactions.disclaimer.text')}</p>
          <div class="footer-links">
            <a href="https://github.com/ya-luotao/adhd-db" target="_blank">GitHub</a>
            <span class="footer-sep">Â·</span>
            <a href={getLocalizedPath('/', lang)}>{t('nav.home')}</a>
            <span class="footer-sep">Â·</span>
            <a href={getLocalizedPath('/data/drugs', lang)}>{t('nav.database')}</a>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>

<script define:vars={{ drugsData, drugClassesData, nutrientsData, lang }}>
  const drugs = JSON.parse(drugsData);
  const drugClasses = JSON.parse(drugClassesData);
  const nutrients = JSON.parse(nutrientsData);

  const checkBtn = document.getElementById('check-btn');
  const clearBtn = document.getElementById('clear-btn');
  const results = document.getElementById('results');
  const resultsContent = document.getElementById('results-content');
  const classButtons = document.querySelectorAll('.class-button');

  let selectedClass = null;

  // Severity colors
  const severityColors = {
    major: { bg: 'rgba(239, 68, 68, 0.1)', color: '#dc2626', label: lang === 'zh' ? 'ä¸¥é‡' : lang === 'ja' ? 'é‡å¤§' : 'Major' },
    moderate: { bg: 'rgba(245, 158, 11, 0.1)', color: '#d97706', label: lang === 'zh' ? 'ä¸­ç­‰' : lang === 'ja' ? 'ä¸­ç¨‹åº¦' : 'Moderate' },
    minor: { bg: 'rgba(34, 197, 94, 0.1)', color: '#16a34a', label: lang === 'zh' ? 'è½»å¾®' : lang === 'ja' ? 'è»½åº¦' : 'Minor' },
  };

  // Drug class interaction data
  const classInteractions = {
    MAOI: {
      severity: 'major',
      affectedDrugs: ['methylphenidate', 'amphetamine-mixed-salts', 'lisdexamfetamine', 'atomoxetine', 'viloxazine'],
      note: {
        en: 'CONTRAINDICATED. Risk of hypertensive crisis. Wait 14 days after stopping MAOI.',
        zh: 'ç¦å¿Œã€‚é«˜è¡€å‹å±è±¡é£é™©ã€‚åœç”¨MAOIåéœ€ç­‰å¾…14å¤©ã€‚',
        ja: 'ç¦å¿Œã€‚é«˜è¡€åœ§ã‚¯ãƒªãƒ¼ã‚¼ã®ãƒªã‚¹ã‚¯ã€‚MAOIä¸­æ­¢å¾Œ14æ—¥é–“ã¯å¾…æ©Ÿã€‚',
      },
    },
    SSRI: {
      severity: 'moderate',
      affectedDrugs: ['methylphenidate', 'amphetamine-mixed-salts', 'lisdexamfetamine', 'atomoxetine'],
      note: {
        en: 'Increased risk of serotonin syndrome. Monitor for agitation, confusion, rapid heart rate.',
        zh: 'è¡€æ¸…ç´ ç»¼åˆå¾é£é™©å¢åŠ ã€‚æ³¨æ„è§‚å¯ŸèºåŠ¨ã€æ„è¯†æ··ä¹±ã€å¿ƒè·³åŠ é€Ÿã€‚',
        ja: 'ã‚»ãƒ­ãƒˆãƒ‹ãƒ³ç—‡å€™ç¾¤ã®ãƒªã‚¹ã‚¯å¢—åŠ ã€‚èˆˆå¥®ã€æ··ä¹±ã€é »è„ˆã«æ³¨æ„ã€‚',
      },
    },
    SNRI: {
      severity: 'moderate',
      affectedDrugs: ['methylphenidate', 'amphetamine-mixed-salts', 'lisdexamfetamine', 'atomoxetine'],
      note: {
        en: 'Additive cardiovascular effects. Monitor blood pressure and heart rate.',
        zh: 'å åŠ å¿ƒè¡€ç®¡ä½œç”¨ã€‚ç›‘æµ‹è¡€å‹å’Œå¿ƒç‡ã€‚',
        ja: 'å¿ƒè¡€ç®¡ä½œç”¨ã®ç›¸åŠ ã€‚è¡€åœ§ã¨å¿ƒæ‹æ•°ã‚’ç›£è¦–ã€‚',
      },
    },
    TCA: {
      severity: 'moderate',
      affectedDrugs: ['methylphenidate', 'amphetamine-mixed-salts', 'lisdexamfetamine', 'clonidine'],
      note: {
        en: 'Stimulants may increase TCA levels. Clonidine effectiveness may be reduced. Monitor ECG.',
        zh: 'å…´å¥‹å‰‚å¯èƒ½å¢åŠ TCAæ°´å¹³ã€‚å¯ä¹å®šæ•ˆæœå¯èƒ½é™ä½ã€‚ç›‘æµ‹å¿ƒç”µå›¾ã€‚',
        ja: 'åˆºæ¿€è–¬ãŒTCAæ¿ƒåº¦ã‚’ä¸Šæ˜‡ã•ã›ã‚‹å¯èƒ½æ€§ã€‚ã‚¯ãƒ­ãƒ‹ã‚¸ãƒ³ã®åŠ¹æœãŒæ¸›å¼±ã™ã‚‹å¯èƒ½æ€§ã€‚å¿ƒé›»å›³ã‚’ç›£è¦–ã€‚',
      },
    },
    benzodiazepine: {
      severity: 'moderate',
      affectedDrugs: ['clonidine', 'guanfacine'],
      note: {
        en: 'Additive CNS depression. May counteract ADHD medication effects. Use with caution.',
        zh: 'å åŠ ä¸­æ¢æŠ‘åˆ¶ä½œç”¨ã€‚å¯èƒ½æŠµæ¶ˆADHDè¯ç‰©æ•ˆæœã€‚è°¨æ…ä½¿ç”¨ã€‚',
        ja: 'ä¸­æ¢æŠ‘åˆ¶ä½œç”¨ã®ç›¸åŠ ã€‚ADHDè–¬ã®åŠ¹æœã‚’ç›¸æ®ºã™ã‚‹å¯èƒ½æ€§ã€‚æ…é‡ã«ä½¿ç”¨ã€‚',
      },
    },
    antipsychotic: {
      severity: 'moderate',
      affectedDrugs: ['methylphenidate', 'amphetamine-mixed-salts', 'lisdexamfetamine'],
      note: {
        en: 'May reduce stimulant efficacy. Monitor for movement disorders. Aripiprazole often used adjunctively.',
        zh: 'å¯èƒ½é™ä½å…´å¥‹å‰‚æ•ˆæœã€‚æ³¨æ„è¿åŠ¨éšœç¢ã€‚é˜¿ç«‹å“Œå”‘å¸¸ä½œä¸ºè¾…åŠ©ç”¨è¯ã€‚',
        ja: 'åˆºæ¿€è–¬ã®åŠ¹æœã‚’æ¸›å¼±ã•ã›ã‚‹å¯èƒ½æ€§ã€‚é‹å‹•éšœå®³ã«æ³¨æ„ã€‚ã‚¢ãƒªãƒ”ãƒ—ãƒ©ã‚¾ãƒ¼ãƒ«ã¯è£œåŠ©çš„ã«ä½¿ç”¨ã€‚',
      },
    },
  };

  // Toggle class button selection
  classButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      const isActive = btn.classList.contains('active');
      classButtons.forEach(b => b.classList.remove('active'));
      if (!isActive) {
        btn.classList.add('active');
        selectedClass = btn.dataset.class;
      } else {
        selectedClass = null;
      }
    });
  });

  // Clear results
  clearBtn?.addEventListener('click', () => {
    results.classList.add('hidden');
    resultsContent.innerHTML = '';
  });

  // Check interactions
  checkBtn.addEventListener('click', () => {
    const selectedDrugs = Array.from(document.querySelectorAll('input[name="drug"]:checked'))
      .map(cb => cb.value);

    if (selectedDrugs.length === 0) {
      alert(lang === 'zh' ? 'è¯·é€‰æ‹©è‡³å°‘ä¸€ç§è¯ç‰©' : lang === 'ja' ? 'å°‘ãªãã¨ã‚‚1ã¤ã®è–¬ã‚’é¸æŠã—ã¦ãã ã•ã„' : 'Please select at least one medication');
      return;
    }

    let html = '<div class="results-list">';

    // Check each selected drug
    selectedDrugs.forEach(drugId => {
      const drug = drugs.find(d => d.id === drugId);
      if (!drug) return;

      let interactions = [];

      // Check drug class interactions if a class is selected
      if (selectedClass && classInteractions[selectedClass]) {
        const classData = classInteractions[selectedClass];
        if (classData.affectedDrugs.includes(drugId)) {
          interactions.push({
            type: 'class',
            with: drugClasses.find(c => c.id === selectedClass)?.label || selectedClass,
            severity: classData.severity,
            note: classData.note[lang] || classData.note.en,
          });
        }
      }

      // Check drug-drug interactions from existing data
      if (drug.drugInteractions) {
        drug.drugInteractions.forEach(interaction => {
          interactions.push({
            type: 'drug',
            with: interaction.drug,
            severity: interaction.severity,
            note: interaction.effect,
          });
        });
      }

      // Build result card
      const severityInfo = interactions.length > 0
        ? severityColors[interactions.reduce((acc, i) =>
            i.severity === 'major' ? 'major' :
            (acc === 'major' ? acc : i.severity === 'moderate' ? 'moderate' : acc)
          , 'minor')]
        : { bg: 'rgba(34, 197, 94, 0.1)', color: '#16a34a', label: lang === 'zh' ? 'æ— å·²çŸ¥' : lang === 'ja' ? 'æ—¢çŸ¥ãªã—' : 'None known' };

      html += `
        <div class="result-card">
          <div class="result-drug-header">
            <span class="result-drug-name">${drug.genericName}</span>
            <span class="result-drug-class" data-class="${drug.drugClass}">${drug.drugClass}</span>
          </div>
          <div class="result-summary" style="background: ${severityInfo.bg}; border-left: 3px solid ${severityInfo.color}">
            <span class="summary-label">${interactions.length} ${lang === 'zh' ? 'æ¡ç›¸äº’ä½œç”¨' : lang === 'ja' ? 'ä»¶ã®ç›¸äº’ä½œç”¨' : 'interaction(s)'}</span>
            <span class="summary-severity" style="color: ${severityInfo.color}">${severityInfo.label}</span>
          </div>
          ${interactions.length > 0 ? `
            <div class="result-interactions">
              ${interactions.map(i => `
                <div class="interaction-item" data-severity="${i.severity}">
                  <div class="interaction-header">
                    <span class="interaction-with">${i.with}</span>
                    <span class="interaction-severity" style="background: ${severityColors[i.severity].bg}; color: ${severityColors[i.severity].color}">
                      ${severityColors[i.severity].label}
                    </span>
                  </div>
                  <p class="interaction-note">${i.note}</p>
                </div>
              `).join('')}
            </div>
          ` : `
            <div class="result-no-interactions">
              <span class="no-interaction-icon">âœ“</span>
              <span>${lang === 'zh' ? 'æœªå‘ç°å·²çŸ¥ç›¸äº’ä½œç”¨' : lang === 'ja' ? 'æ—¢çŸ¥ã®ç›¸äº’ä½œç”¨ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ' : 'No known interactions found'}</span>
            </div>
          `}
        </div>
      `;
    });

    html += '</div>';

    resultsContent.innerHTML = html;
    results.classList.remove('hidden');
    results.scrollIntoView({ behavior: 'smooth', block: 'start' });
  });
</script>

<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body {
    font-family: 'DM Sans', -apple-system, sans-serif;
    background: #fafaf9;
    color: #1a1a1a;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
  }

  .page {
    --accent: #c4a052;
    --accent-dark: #a68a3a;
    --accent-light: rgba(196, 160, 82, 0.1);
    --stimulant: #dc2626;
    --non-stimulant: #2563eb;
    --text-primary: #1a1a1a;
    --text-secondary: #525252;
    --text-muted: #a3a3a3;
    --border: #e5e5e5;
    --surface: #ffffff;
    --surface-alt: #f5f5f4;
    --warning: #f59e0b;
    --danger: #ef4444;
    --success: #22c55e;
  }

  /* Navigation */
  .nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.5rem 4rem;
    position: sticky;
    top: 0;
    background: rgba(250, 250, 249, 0.9);
    backdrop-filter: blur(12px);
    z-index: 100;
    border-bottom: 1px solid var(--border);
  }

  .nav-logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: var(--text-primary);
  }

  .logo-mark { color: var(--accent); font-size: 1.25rem; }
  .logo-text { font-family: 'DM Mono', monospace; font-weight: 500; font-size: 1rem; }

  .nav-links { display: flex; gap: 2.5rem; }
  .nav-links a {
    text-decoration: none;
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
    transition: color 0.2s;
  }
  .nav-links a:hover, .nav-links a.active { color: var(--accent); }

  .nav-lang { display: flex; gap: 0.25rem; }
  .lang-link {
    padding: 0.4rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
    text-decoration: none;
    color: var(--text-muted);
    border-radius: 4px;
    transition: all 0.2s;
  }
  .lang-link:hover { color: var(--accent); background: var(--accent-light); }
  .lang-link.active { color: white; background: var(--accent); }

  /* Hero */
  .hero {
    text-align: center;
    padding: 4rem 2rem 3rem;
    border-bottom: 1px solid var(--border);
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--accent-light);
    color: var(--accent);
    border-radius: 100px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
  }

  .badge-icon { font-size: 1rem; }

  .hero-title {
    font-family: 'Instrument Serif', serif;
    font-size: 3rem;
    font-weight: 400;
    margin-bottom: 1rem;
  }

  .hero-desc {
    font-size: 1.1rem;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
  }

  /* Tool Section */
  .tool-section {
    padding: 3rem 4rem;
    max-width: 1000px;
    margin: 0 auto;
  }

  .checker-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  /* Form */
  .checker-form {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
  }

  .form-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.25rem;
  }

  .form-header:not(:first-child) { margin-top: 2rem; }

  .form-step {
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent);
    color: white;
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    font-weight: 600;
    border-radius: 50%;
  }

  .form-header h2 {
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  /* Drug Grid */
  .drug-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 0.75rem;
  }

  .drug-checkbox {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.875rem 1rem;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .drug-checkbox:hover { border-color: var(--accent); }
  .drug-checkbox:has(input:checked) {
    border-color: var(--accent);
    background: var(--accent-light);
  }

  .drug-checkbox input { display: none; }

  .checkbox-mark {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all 0.15s;
  }

  .drug-checkbox:has(input:checked) .checkbox-mark {
    background: var(--accent);
    border-color: var(--accent);
  }

  .drug-checkbox:has(input:checked) .checkbox-mark::after {
    content: 'âœ“';
    color: white;
    font-size: 0.7rem;
    font-weight: 700;
  }

  .checkbox-label {
    font-size: 0.9rem;
    font-weight: 500;
    flex: 1;
  }

  .checkbox-class {
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    padding: 2px 6px;
    border-radius: 4px;
    background: var(--surface);
  }

  .drug-checkbox[data-class="stimulant"] .checkbox-class {
    color: var(--stimulant);
  }
  .drug-checkbox[data-class="non-stimulant"] .checkbox-class {
    color: var(--non-stimulant);
  }

  /* Class Buttons */
  .class-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .class-button {
    padding: 0.625rem 1rem;
    background: var(--surface-alt);
    border: 1px solid var(--border);
    border-radius: 100px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s;
  }

  .class-button:hover { border-color: var(--accent); color: var(--accent); }
  .class-button.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  .check-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    width: 100%;
    padding: 1rem;
    margin-top: 1.5rem;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 8px;
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .check-button:hover {
    background: var(--accent-dark);
    transform: translateY(-2px);
  }

  .check-button .btn-arrow { transition: transform 0.2s; }
  .check-button:hover .btn-arrow { transform: translateX(4px); }

  /* Results */
  .results { animation: slideUp 0.3s ease; }
  .results.hidden { display: none; }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .results-header h2 {
    font-family: 'Instrument Serif', serif;
    font-size: 1.5rem;
    font-weight: 400;
  }

  .clear-button {
    padding: 0.5rem 1rem;
    background: transparent;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 0.85rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s;
  }

  .clear-button:hover {
    border-color: var(--danger);
    color: var(--danger);
  }

  .results-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .result-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .result-drug-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
  }

  .result-drug-name { font-weight: 600; }
  .result-drug-class {
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    text-transform: uppercase;
    padding: 4px 8px;
    border-radius: 4px;
    background: var(--surface-alt);
  }

  .result-drug-class[data-class="stimulant"] { color: var(--stimulant); }
  .result-drug-class[data-class="non-stimulant"] { color: var(--non-stimulant); }

  .result-summary {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 1.25rem;
    margin: 1rem;
    border-radius: 8px;
  }

  .summary-label { font-size: 0.9rem; }
  .summary-severity { font-weight: 600; text-transform: uppercase; font-size: 0.8rem; }

  .result-interactions { padding: 0 1.25rem 1rem; }

  .interaction-item {
    padding: 1rem;
    margin-bottom: 0.5rem;
    background: var(--surface-alt);
    border-radius: 8px;
  }

  .interaction-item:last-child { margin-bottom: 0; }

  .interaction-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .interaction-with { font-weight: 600; font-size: 0.9rem; }
  .interaction-severity {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .interaction-note {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  .result-no-interactions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1.25rem;
    color: var(--success);
  }

  .no-interaction-icon { font-size: 1.25rem; }

  /* Nutrient Section */
  .nutrient-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 2rem;
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
  }

  .section-icon { font-size: 1.5rem; }
  .section-header h2 {
    font-family: 'DM Sans', sans-serif;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .nutrient-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 1rem;
  }

  .nutrient-card {
    padding: 1.25rem;
    background: var(--surface-alt);
    border-radius: 12px;
    border-left: 3px solid var(--warning);
  }

  .nutrient-card[data-severity="major"] { border-left-color: var(--danger); }
  .nutrient-card[data-severity="minor"] { border-left-color: var(--success); }

  .nutrient-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .nutrient-name { font-weight: 600; }
  .nutrient-severity { font-size: 1rem; }
  .nutrient-severity[data-severity="major"] { color: var(--danger); }
  .nutrient-severity[data-severity="moderate"] { color: var(--warning); }

  .nutrient-effect {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
    line-height: 1.5;
  }

  .nutrient-rec {
    font-size: 0.8rem;
    color: var(--text-muted);
    font-style: italic;
  }

  /* Disclaimer */
  .disclaimer {
    display: flex;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    margin-top: 2rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
  }

  .disclaimer-icon {
    font-size: 1.25rem;
    color: var(--warning);
    flex-shrink: 0;
  }

  .disclaimer-content strong {
    display: block;
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
  }

  .disclaimer-content p {
    font-size: 0.85rem;
    color: var(--text-secondary);
    margin: 0;
  }

  /* Quick Links */
  .quick-links {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 4rem 4rem;
  }

  .quick-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    text-decoration: none;
    color: inherit;
    transition: all 0.2s;
  }

  .quick-link:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
  }

  .quick-icon { font-size: 1.5rem; color: var(--accent); }

  .quick-content h3 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .quick-content p {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin: 0;
  }

  .quick-arrow {
    margin-left: auto;
    font-size: 1.25rem;
    color: var(--text-muted);
    transition: all 0.2s;
  }

  .quick-link:hover .quick-arrow {
    color: var(--accent);
    transform: translateX(4px);
  }

  /* Footer */
  .footer {
    padding: 2rem 4rem;
    background: var(--surface-alt);
    border-top: 1px solid var(--border);
  }

  .footer-content {
    max-width: 600px;
    margin: 0 auto;
    text-align: center;
  }

  .footer-disclaimer {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
  }

  .footer-links {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.75rem;
  }

  .footer-links a {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.85rem;
    transition: color 0.2s;
  }

  .footer-links a:hover { color: var(--accent); }
  .footer-sep { color: var(--text-muted); }

  /* Responsive */
  @media (max-width: 768px) {
    .nav { padding: 1rem 1.5rem; flex-wrap: wrap; gap: 1rem; }
    .nav-links { display: none; }

    .hero { padding: 3rem 1.5rem 2rem; }
    .hero-title { font-size: 2rem; }

    .tool-section { padding: 2rem 1.5rem; }

    .drug-grid { grid-template-columns: 1fr; }
    .nutrient-grid { grid-template-columns: 1fr; }

    .quick-links {
      grid-template-columns: 1fr;
      padding: 0 1.5rem 3rem;
    }

    .footer { padding: 1.5rem; }
  }
</style>
